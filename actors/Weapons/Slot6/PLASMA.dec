ACTOR PlasmaAmmo : Ammo
{
   Inventory.Amount 0
   Inventory.MaxAmount 50
   Ammo.BackpackAmount 0
   Ammo.BackpackMaxAmount 50
   +INVENTORY.IGNORESKILL
   Inventory.Icon "PLASA0"
}

ACTOR LeftPlasmaAmmo : Ammo
{
   Inventory.Amount 0
   Inventory.MaxAmount 50
   Ammo.BackpackAmount 0
   Ammo.BackpackMaxAmount 50
   +INVENTORY.IGNORESKILL
   Inventory.Icon "PLASA0"
}

Actor HasPlasmaWeapon: Inventory
{
inventory.maxamount 1
}

Actor RespectPlasmaGun : Inventory
{
inventory.maxamount 1
}

Actor DualWieldingPlasma : Inventory
{
inventory.maxamount 1
}

Actor PB_PlasmaFireAnimation1: Inventory
{
Inventory.maxamount 1
}
Actor PB_PlasmaFireAnimation2: Inventory
{
Inventory.maxamount 1
}

// This is to make the no doomguy talk cvar work, as it's impossible to
// use cvars on sndinfo and on Inventory.PickupSound
ACTOR PB_M1PlasmaPickup : PB_UpgradeItem
{
	Inventory.PickupSound ""
	Inventory.PickupMessage "You got the UAC-M1 Plasma Rifle! (Slot 7)"
	Inventory.MaxAmount 3
	Scale 0.51
	FloatBobStrength 0.5
	States
	{
	Spawn:
		VLAS A 0 NoDelay
		PLAS A 10 {
			if ( GetCvar( "V5_MODELS" ) == 1 ){
				If ( GetCVar( "V5_Cull" ) == 0 ) {
					A_SetSpawnSprite("VLAS");
					If ( GetCvar( "V5_Quake3" ) == 1 ){
						A_settics(1); bFLOATBOB = true; A_setangle(normalize180(angle) + V5_Q3Spin,SPF_INTERPOLATE); SetZ(floorz+16.0);
					}
					else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
				}
				else {
					if( !A_CHECKRANGE( V5_MDist , "NULL", TRUE) ) {
						A_SetSpawnSprite("VLAS");
						If ( GetCvar( "V5_Quake3" ) == 1 ){
							A_settics(1); bFLOATBOB = true; A_setangle(normalize180(angle) + V5_Q3Spin,SPF_INTERPOLATE); SetZ(floorz+16.0);
						}
						else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
					}
					else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
				}
			}
			else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
		}
		"####" A 0 {
				If ( GetCVar( "V5_MODELS" ) == 1 && GetCvar( "V5_Quake3" ) == 1 ){
				If ( GetCVar( "V5_Cull" ) == 0 ) {SetZ(floorz+16.0);}
					else{ 
						if( A_CHECKRANGE( V5_MDist , "NULL", TRUE) ) {bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
					}
				}
				else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
		}
		LOOP
// I'm sorry if this is a fucking hackjob, but it's the only way I can prevent
// the M1 Plasma pickup from happen if the ammo count is full.
	Pickup:
		TNT1 A 0 {
			if(CountInv("Cell") == 300 && CountInv("PB_M1Plasma") >=3 && CountInv("GotAPack") < 1 && CountInv("GotAPack_h") < 1) {
				return state("FullAmmo");
				}
			else if(CountInv("Cell") == 600 && CountInv("PB_M1Plasma") >=3 && CountInv("GotAPack") >= 1 && CountInv("GotAPack_h") < 1) {
				return state("FullAmmo");
				}
			else if(CountInv("Cell") == 800 && CountInv("PB_M1Plasma") >=3 && CountInv("GotAPack") >= 1 && CountInv("GotAPack_h") >= 1) {
				return state("FullAmmo");
				}
				return state("");
			}
		TNT1 A 0 {
			A_GiveInventory("PB_M1Plasma");
			if(GetCvar("nodoomguytalk") >= 1) {
				A_StartSound("7LSPICK",3,CHANF_NOPAUSE );
				}
			else {
				A_StartSound("PLSPICK",3,CHANF_NOPAUSE );
				}
		}
		Stop
	FullAmmo:
		TNT1 A 1
		TNT1 A 0
		Fail
	}
}

Actor PlasmaRifleHasUnloaded : Inventory {}

// --------------------------------------------------------------------------

// Plasma Gun

// --------------------------------------------------------------------------

ACTOR PB_M1Plasma : PB_Weapon //Replaces PlasmaRifle
{
	Weapon.BobRangeX 0.3
	Weapon.BobRangeY 0.5
	Weapon.BobStyle InverseSmooth
	Weapon.BobSpeed 2.4
	Inventory.MaxAmount 3
	Inventory.Amount 1
	Weapon.SelectionOrder 100
	Weapon.AmmoUse1 0
	Weapon.AmmoGive1 50
	Weapon.AmmoUse2 0
	Weapon.AmmoGive2 0
    Inventory.PickupSound "7LSPICK"
	Weapon.AmmoType1 "Cell"
	Weapon.AmmoType2 "PlasmaAmmo"
    +WEAPON.NOAUTOAIM
	+WEAPON.NOALERT
	+FLOORCLIP
	+DONTGIB
	Inventory.PickupMessage "You got the UAC-M1 Plasma Rifle! (Slot 7)"
	Tag "UAC-M1 Plasma Rifle"
	PB_WeaponBase.UnloaderToken "PlasmaRifleHasUnloaded"
	Scale 0.51
	Inventory.AltHUDIcon "PLASA0"
	PB_WeaponBase.respectItem "RespectPlasmaGun"
	FloatBobStrength 0.5
	States
	{
	Steady:
	TNT1 A 1
	Goto Ready

	Ready:
		TNT1 A 0 A_SelectWeapon("PB_Pulsecannon")
		TNT1 A 0 PB_RespectIfNeeded
	WeaponRespect:
		TNT1 A 0 {
			A_SetCrosshair(5);
			A_GiveInventory("RespectPlasmaGun");
			A_Giveinventory("PB_LockScreenTilt",1);
			A_PlaySoundEx("Ironsights", "Auto");
		}
		P0R0 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 {
			A_DoPBWeaponAction;
			}

		P0R1 ABCDEFGHIJKLMNOPQ 1 {
			A_DoPBWeaponAction;
			}
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/fancybutton", "Auto")
		P0R1 RSTUVWXYZ 1 {
			A_DoPBWeaponAction;
			}
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellin", "Auto")
		P0R2 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 {
			A_DoPBWeaponAction;
			}
		P0R3 ABCDEFGH 1 {
			A_DoPBWeaponAction;
			}
		TNT1 A 0 A_PlaySoundEx("weapons/carbine/fancybutton", "Auto")
		P0R3 JKLLLL 1 {
			A_DoPBWeaponAction;
			}
		TNT1 A 0 A_PlaySoundEx("Ironsights", "Auto")
		P0R3 MNOPQRSTUVWXYZ 1 {
			A_DoPBWeaponAction;
			}
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/startup", "Auto")
		P0R4 A 1{ 
			A_FireCustomMissile("SmokeSpawner",0,0,15,5);
			A_FireCustomMissile("PlasmaFlareSpawner",0,0,15,5);
			A_FireCustomMissile("BlueFlareSpawn",0,0,14,5);
			A_FireCustomMissile("BluePlasmaParticle",random(340,350),0,6,0,0,random(7,18) );
			A_SetRoll(roll-0.4, SPF_INTERPOLATE);			
			}
		P0R4 B 1{ 
			A_FireCustomMissile("SmokeSpawner",0,0,15,5);
			A_FireCustomMissile("PlasmaFlareSpawner",0,0,14,4);
			A_FireCustomMissile("BlueFlareSpawn",0,0,14,5);
			A_FireCustomMissile("BluePlasmaParticle",random(340,350),0,6,0,0,random(7,18) );
			A_SetRoll(roll-0.4, SPF_INTERPOLATE);
			}
		P0R4 C 1{ 
			A_FireCustomMissile("SmokeSpawner",0,0,15,4);
			A_FireCustomMissile("PlasmaFlareSpawner",0,0,15,4);
			A_FireCustomMissile("BlueFlareSpawn",0,0,15,5);
			A_FireCustomMissile("BluePlasmaParticle",random(340,350),0,6,0,0,random(7,18) );
			A_SetRoll(roll-0.4, SPF_INTERPOLATE);
			}
		P0R4 D 1{ 
			A_FireCustomMissile("SmokeSpawner",0,0,15,4);
			A_FireCustomMissile("PlasmaFlareSpawner",0,0,15,4);
			A_FireCustomMissile("BlueFlareSpawn",0,0,15,5);
			A_FireCustomMissile("BluePlasmaParticle",random(340,350),0,6,0,0,random(7,18) );
			A_SetRoll(roll+0.4, SPF_INTERPOLATE);
			}
		P0R4 E 1{ 
			A_FireCustomMissile("SmokeSpawner",0,0,15,4);
			A_FireCustomMissile("PlasmaFlareSpawner",0,0,15,4);
			A_FireCustomMissile("BlueFlareSpawn",0,0,15,5);
			A_FireCustomMissile("BluePlasmaParticle",random(340,350),0,6,0,0,random(7,18) );
			A_SetRoll(roll+0.4, SPF_INTERPOLATE);
			}
		P0R4 F 1{ 
			A_FireCustomMissile("SmokeSpawner",0,0,16,4);
			A_FireCustomMissile("PlasmaFlareSpawner",0,0,16,4);
			A_FireCustomMissile("BlueFlareSpawn",0,0,16,5);
			A_FireCustomMissile("BluePlasmaParticle",random(340,350),0,6,0,0,random(7,18) );
			A_SetRoll(roll+0.4, SPF_INTERPOLATE);
			}
		P0R4 GHI 1 { 
			A_FireCustomMissile("SmokeSpawner",0,0,16,4);
			A_FireCustomMissile("BluePlasmaParticle",random(340,350),0,6,0,0,random(7,18) );
			}
		P0R4 JKLMNOPQRST 1 A_DoPBWeaponAction
		TNT1 A 0 A_PlaySoundEx("PLREADY", "Auto")
		P0R4 UVWXYZ 1 A_DoPBWeaponAction
		P0R5 ABCDEF 1 A_DoPBWeaponAction
		TNT1 A 0 A_PlaySoundEx("PLSDRAW", "Auto")
		Goto Ready3
		
	SelectAnimation:
		TNT1 A 0 A_PlaySoundEx("PLSDRAW", "Auto")
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "SelectAnimationDualWield")
		PLSD ABCD 1
	Ready3:
		TNT1 A 0 {
			A_TakeInventory("PB_LockScreenTilt",1);
			PB_HandleCrosshair(76);
			}
		TNT1 A 0 A_PlaySound("PLSIDLE", 6,1,1)
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "ReadyDualWield")
	ReadyToFire:
		4LSG B 0 A_DoPBWeaponAction
		4LSG BCDEFGHI 2 A_DoPBWeaponAction
		TNT1 A 0 A_SelectWeapon("PB_Pulsecannon")
		Loop
	GunEmpty:
		P1R0 A 1 A_DoPBWeaponAction(WRF_ALLOWRELOAD, PBWEAP_UNLOADED)
		Loop
		
	SelectAnimationDualWield:
		DPRS ABCD  1
		TNT1 A 0 A_PlaySoundEx("PLSDRAW", "Auto")
	ReadyDualWield:
		TNT1 A 0 {
			A_SetRoll(0);
			PB_HandleCrosshair(76);
			A_TakeInventory("PB_LockScreenTilt",1);
			A_SetFiringRightWeapon(False);
			A_SetFiringLeftWeapon(False);
			if(CountInv("LeftPlasmaAmmo") < CountInv("PlasmaAmmo")){
				A_GiveInventory("DualFiring",1);
			}
			if(CountInv("Cell")>0){
				if(CountInv("LeftPlasmaAmmo")<=0){
					A_GiveInventory("DualFireReload",1);
				}
				if(CountInv("PlasmaAmmo")<=0){
					A_GiveInventory("DualFireReload",1);
				}
			}
			A_Overlay(10, "IdleLeft_Overlay", true);
			A_Overlay(11, "IdleRight_Overlay", true);
			}
		TNT1 A 0 A_PlaySound("PLSIDLE", 6,1,1)
	ReadyToFireDualWield:
		TNT1 A 1 A_DoPBWeaponAction(WRF_ALLOWRELOAD|WRF_NOFIRE)
		Loop
	
	ReadyDualUnloaded:
		TNT1 A 0 A_StopSound(6)
		P2R1 A 1 A_DoPBWeaponAction(WRF_ALLOWRELOAD|WRF_NOFIRE)
		Loop
		
	IdleLeft_Overlay:
		DPR3 ABCDEFGH 2 {
			// Full-Auto
			if(CountInv("LeftPlasmaAmmo")<=0 && CountInv("PlasmaAmmo")>0){
				A_GiveInventory("DualFiring",1);
			}
			if(CountInv("DualFiring")==0 || (CountInv("DualFiring")==0 && CountInv("PlasmaAmmo")<=0) || GetCvar("SingleDualFire")==1){
				if(PressingFire() || JustPressed(BT_ATTACK)){
					if(CountInv("LeftPlasmaAmmo") > 0){
						return state("FireLeft_Overlay");
					}
					else {
						A_PlaySoundEx("weapons/empty", "Auto");
						return state("");
					}
				}
			}
			return state("");
		}
		Loop
	IdleRight_Overlay:
		DPR4 ABCDEFGH 2 {
			// Full-Auto
			if(CountInv("LeftPlasmaAmmo")>0 && CountInv("PlasmaAmmo")<=0){
				A_TakeInventory("DualFiring",1);
			}
			if(CountInv("DualFiring")==1 || (CountInv("DualFiring")==1 && CountInv("LeftPlasmaAmmo")<=0)){
				if((PressingFire() || JustPressed(BT_ATTACK)) && !A_IsFiringLeftWeapon() && GetCvar("SingleDualFire")==0){
					if(CountInv("PlasmaAmmo") > 0){
						return state("FireRight_Overlay");
					}
					else {
						A_PlaySoundEx("weapons/empty", "Auto");
						return state("");
					}
				}
			}
			if((PressingAltfire() || JustPressed(BT_ALTATTACK)) && !A_IsFiringRightWeapon() && GetCvar("SingleDualFire")==1){
				if(CountInv("PlasmaAmmo") > 0){
					return state("FireRight_Overlay");
				}
				else {
					A_PlaySoundEx("weapons/empty", "Auto");
					return state("");
				}
			}
			return state("");
		}
		Loop
		
	FireLeft_Overlay:
		DPR2 A 1 BRIGHT {
			A_FireCustomMissile("Plasma_Ball", 0.1, 0, -6, -4, 0, 0);
			A_FireCustomMissile("GunFireSmoke", 0, 0, -4, 0, 0, 0);
			A_PlaySoundEx("PLSM9", "Weapon");
			A_AlertMonsters;
			A_ZoomFactor(0.99);
			A_Takeinventory("LeftPlasmaAmmo",1);
			A_GunFlash;
            PB_WeaponRecoil(-1.4,+0.8);
			}
		DPR2 B 1 BRIGHT {
			A_ZoomFactor(0.99);
			if (CountInv("LeftPlasmaAmmo")<=0 || CountInv("PlasmaAmmo")>0 ){
				A_GiveInventory("DualFiring",1);
				}
            PB_WeaponRecoil(-1.4,+0.8);
			}
		DPR2 C 1 {
			A_ZoomFactor(1.0);
			}
		TNT1 A 0 {
			if(CountInv("LeftPlasmaAmmo")<=0){
				A_GiveInventory("DualFireReload",1);
			}
		}
		Goto IdleLeft_Overlay
		
	
	FireRight_Overlay:
		DPR1 A 1 BRIGHT {
			A_FireCustomMissile("Plasma_Ball", 0.1, 0, 6, -4, 0, 0);
			A_FireCustomMissile("GunFireSmoke", 0, 0, 4, 0, 0, 0);
			A_PlaySoundEx("PLSM9", "Weapon");
			A_AlertMonsters;
			A_ZoomFactor(0.98);
			A_Takeinventory("PlasmaAmmo",1);
			A_GunFlash;
            PB_WeaponRecoil(-1.4,-0.8);
			}
		DPR1 B 1 BRIGHT {
			A_ZoomFactor(0.99);
			if(CountInv("LeftPlasmaAmmo")>0 || CountInv("PlasmaAmmo")<=0 ){
				A_TakeInventory("DualFiring",1);
				}
            PB_WeaponRecoil(-1.4,-0.8);
			}
		DPR1 C 1 {
			A_ZoomFactor(1.0);
			}
		TNT1 A 0 {
			if(CountInv("PlasmaAmmo")<=0){
				A_GiveInventory("DualFireReload",1);
			}
		}
		Goto IdleRight_Overlay
		
		
	WeaponSpecial:
		TNT1 A 0 {
			A_Takeinventory("GoWeaponSpecialAbility",1);
			A_GiveInventory("PB_LockScreenTilt",1);
			PB_HandleCrosshair(76);
			A_PlaySoundEx("Ironsights", "Auto");
			A_ClearOverlays(10,11);
			}
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1,"StopDualWield")
		TNT1 A 0 A_JumpIfInventory("PB_M1Plasma", 2,"SwitchToDualWield")
		TNT1 A 0 A_print("You need two plasma rifles to dual wield!")
		Goto Ready3
	StopDualWield:
		TNT1 A 0 A_Takeinventory("DualWieldingPlasma",1)
		P2R0 HGE 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		P2R0 DCBA 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		Goto Ready3
	SwitchToDualWield:
		TNT1 A 0 A_Giveinventory("DualWieldingPlasma",1)
		P2R0 ABCD 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P2R0 EGH 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		Goto ReadyDualWield
		
	Deselect:
		TNT1 A 0 {
			A_WeaponOffset(0,32);
			A_SetRoll(0);
			PB_HandleCrosshair(76);
			A_TakeInventory("PB_LockScreenTilt",1);
			A_ClearOverlays(10,11);
		}
		TNT1 A 0 A_Takeinventory("HasUnloaded",1)
		TNT1 A 0 A_Takeinventory("Unloading",1)
		TNT1 A 0 A_Takeinventory("HasPlasmaWeapon",1)
		TNT1 A 0 A_TakeInventory("PlasmaGunSelected",1)
		TNT1 A 0 A_Zoomfactor(1.0)
		TNT1 A 0 A_StopSound(6)
	    TNT1 A 0 A_PlaySound("PLSOFF", 4)
		TNT1 A 0 A_JumpIfInventory("GotMeatShield", 1, "GrabEnemy")
		TNT1 A 0 A_JumpIfInventory("PB_Pulsecannon",1,"DeselectUpgrade")
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma",1,"DeselectDualWield")
        PLSD DCBA 1
		TNT1 AAAAAAAAAAAAAAAAAA 0 A_Lower
		Wait
	DeselectUpgrade:
		TNT1 AAAAAAAAAAAAAAAAAA 0 A_Lower
		Wait
	DeselectDualWield:
		DPRS DCBA 1
		TNT1 AAAAAAAAAAAAAAAAAA 0 A_Lower
		Wait
	Select:
		TNT1 A 0 {
			A_WeaponOffset(0,32);
			A_SetRoll(0);
			PB_HandleCrosshair(76);
			A_TakeInventory("PB_LockScreenTilt",1);
			A_ClearOverlays(10,11);
		}
		Goto SelectFirstPersonLegs
		SelectContinue:
		TNT1 A 0 A_SelectWeapon("PB_Pulsecannon")
		TNT1 A 0 A_Takeinventory("HasUnloaded",1)
		TNT1 A 0 A_Takeinventory("Unloading",1)
		TNT1 A 0 A_TakeInventory("RifleSelected",1)
		TNT1 A 0 A_TakeInventory("CarbineSelected",1)
		TNT1 A 0 A_TakeInventory("FistsSelected",1)
		TNT1 A 0 A_TakeInventory("SawSelected",1)
		TNT1 A 0 A_TakeInventory("SledgeSelected",1)
		TNT1 A 0 A_TakeInventory("HandgunSelected",1)
		TNT1 A 0 A_TakeInventory("DualHandgunSelected",1)
		TNT1 A 0 A_TakeInventory("RevolverSelected",1)
		TNT1 A 0 A_TakeInventory("ShotgunSelected",1)
		TNT1 A 0 A_TakeInventory("SSGSelected",1)
		TNT1 A 0 A_TakeInventory("ASGSelected",1)
		TNT1 A 0 A_TakeInventory("QSGSelected",1)
		TNT1 A 0 A_TakeInventory("MinigunSelected",1)
		TNT1 A 0 A_TakeInventory("NewChaingunSelected",1)	
		TNT1 A 0 A_TakeInventory("RocketLauncherSelected",1)
		TNT1 A 0 A_TakeInventory("GrenadeLauncherSelected",1)
		TNT1 A 0 A_TakeInventory("SGLSelected",1)
		TNT1 A 0 A_GiveInventory("PlasmaGunSelected",1)
		TNT1 A 0 A_TakeInventory("M2Selected",1)	
		TNT1 A 0 A_TakeInventory("FreezerSelected",1)
		TNT1 A 0 A_TakeInventory("RailGunSelected",1)
		TNT1 A 0 A_TakeInventory("BFGSelected",1)
		TNT1 A 0 A_TakeInventory("BFGBeamSelected",1)
		TNT1 A 0 A_TakeInventory("BHCSelected",1)
		TNT1 A 0 A_TakeInventory("RevenantLauncherSelected",1)
		TNT1 A 0 A_TakeInventory("FlameCannonSelected",1)
		TNT1 A 0 A_TakeInventory("HellRifleSelected",1)
		TNT1 A 0 A_TakeInventory("LandMineSelected",1)
		TNT1 A 0 A_TakeInventory("UACSMGSelected",1)
		TNT1 A 0 A_TakeInventory("SubMachineGunSelected",1)
		TNT1 A 0 A_TakeInventory("LostSoulSelected",1)
		TNT1 A 0 A_TakeInventory("HasBarrel",1)
		TNT1 A 0 A_TakeInventory("HasIceBarrel", 1)
		TNT1 A 0 A_TakeInventory("HasBurningBarrel",1)
		TNT1 A 0 A_TakeInventory("HasIncendiaryWeapon", 1)
		TNT1 A 0 A_Giveinventory("HasPlasmaWeapon",1)
		TNT1 AAAAAAAAAAAAAAAAAA 0 A_Raise
		TNT1 AAAAAAAA 1 A_Raise
		Wait
		
	Fire:
		TNT1 A 0 {
			A_WeaponOffset(0,32);
			A_SetRoll(0);
			PB_HandleCrosshair(76);
			A_TakeInventory("PB_LockScreenTilt",1);
		}
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "FireDualWield")
        TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",1,1)
        Goto Reload
		PLSF A 1 BRIGHT {	
			A_AlertMonsters;
			A_PlaySoundEx("PLSM9", "Weapon");
			A_FireCustomMissile("Plasma_Ball", 0, 1, 0, 0);
			A_FireCustomMissile("ShakeYourAssMinor", 0, 0, 0, 0);
			A_FireCustomMissile("GunFireSmoke", 0, 0, 0, 0, 0, 0);
			A_Takeinventory("PlasmaAmmo",1);
			A_ZoomFactor(.98);
			A_GunFlash;
            PB_WeaponRecoil(-0.24,+0.06);
			}
		PLSF B 1 {
			A_ZoomFactor(.99);
            PB_WeaponRecoil(-0.24,+0.06);
			}
		PLSF C 1 { 
			A_ZoomFactor(1.0);
            PB_WeaponRecoil(-0.24,+0.06);
			}
		TNT1 A 0 A_ReFire
		TNT1 A 0 A_JumpIf(GetCvar("pb_nocooldown"), "Ready3")
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/startup", "Auto")
		TNT1 A 0 {
			A_Giveinventory("PB_LockScreenTilt",1);
		}
        //P1R1 CBA 1 A_SetRoll(roll+0.5)
        //P1R0 Z 1
		PLSG BCDEEEEEEEEE 1 A_FireCustomMissile("SmokeSpawner",0,0,0,5)
		PLSG DCB 1 A_SetRoll(roll-0.5)
        //P1R0 Z 1
        //P1R1 ABC 1
		TNT1 A 0 {
			A_Takeinventory("PB_LockScreenTilt",1);
		}
		Goto Ready3
		
	AltFire:
		PLHE A 1 
		TNT1 A 0 {
			A_WeaponOffset(0,32);
			A_SetRoll(0);
			PB_HandleCrosshair(76);
			A_TakeInventory("PB_LockScreenTilt",1);
		}
        TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",12,1)
        Goto Reload
		TNT1 A 0 A_StopSound(6)
		TNT1 A 0 A_AlertMonsters
	    TNT1 A 0 A_PlaySound("ULTCHAR", 0)
		PLHE A 10
		TNT1 A 0 A_ZoomFactor(0.995)
		PLHE B 16 BRIGHT
		PLHE C 6 BRIGHT
		PLHE D 3 BRIGHT
		PLHE EFGHIJK 3 BRIGHT A_FireCustomMissile("RailGunTrailSpark_Fast", random(-2,2), 0, random(-2,2), -15, 0, random(-2,2))
		PLSA ABCD 1 BRIGHT {
			A_FireCustomMissile("BlueFlareSpawn",0,0,0,0);
			A_FireCustomMissile("RailGunTrailSpark_Fast", random(-2,2), 0, random(-2,2), -15, 0, random(-2,2));
			if(JustPressed(BT_RELOAD)){return state ("DeCharge");}
				return state ("");
			}
	    TNT1 A 0 A_ReFire
	AltHold:
		TNT1 A 0 A_PlaySoundEx("PLSFULL", "Weapon",1)
        PLSA ABCD 1 BRIGHT {
			A_SpawnItem("PlasmaGauntlet", 0, 1, 0, 0);
			A_SpawnItem("PlasmaGauntlet", 0, 1, 0, 0);
			A_FireCustomMissile("ShakeYourAssMinor", 0, 0, 0, 0);
			A_FireCustomMissile("BlueFlareSpawn",0,0,0,0);
			A_FireCustomMissile("RailGunTrailSpark_Fast", random(-2,2), 0, random(-5,5), -15, 0, random(-2,2));
			if(JustPressed(BT_RELOAD)){return state ("DeCharge");}
				return state ("");
			}
	    TNT1 A 0 A_ReFire
		TNT1 A 0 A_PlaySoundEx("PLSULT", "Weapon")
        PLSG I 1 BRIGHT 
		TNT1 AAAAAAAAAAAAAAAA 0 A_FireCustomMissile("RailGunTrailSpark_Fast", random(-2,2), 0, random(-5,5), -15, 0, random(-2,2))
		TNT1 A 0 A_ZoomFactor(0.85)
		TNT1 A 0 A_GunFlash
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 0, 0, 0, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 5, 1, -1, 10)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -7, 1, 3, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 7, 1, -3, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 5, 1, 1, -10)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -5, 1, 1, 10)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -5, 1, -1, -10)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -3, 1, 0, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 0, 0, 0, -7)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -1, 0, 0, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 0, 0, 0, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 1, 0, 0, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 0, 0, 0, 7)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 3, 1, 0, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 5, 1, -1, 10)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -7, 1, 3, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 7, 1, -3, 0)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", 5, 1, 1, -10)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -5, 0, 1, 10)
		TNT1 A 0 A_FireCustomMissile("UltPlasma_Ball", -5, 0, -1, -10)
	CoolAfterAltFire:
		TNT1 A 0 PB_WeaponRecoilBasic(-1.15) //A_SetPitch(Pitch - 1.15)
		TNT1 A 0 A_Takeinventory("PlasmaAmmo",12)
		
        PLSG J 1 {
			A_ZoomFactor(0.90);
            PB_WeaponRecoil(-2.4,-1.6);
			}
		PLSG K 1 {
			A_ZoomFactor(0.95);
            PB_WeaponRecoil(-2.4,-1.6);
			}
		PLSG L 1 {
			A_ZoomFactor(0.975);
            PB_WeaponRecoil(-2.4,-1.6);
			}
		PLSG K 1 A_ZoomFactor(0.99)
		PLSG J 1 A_ZoomFactor(1.0)
		
        PLSU BCDE 1
		PLSU FFFFFFFFFF 2 A_FireCustomMissile("SmokeSpawner",0,0,0,5)
		PLSG DCB 1
        TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",1,1)
        Goto Reload
        TNT1 A 0 A_PlaySound("BEPBEP")
		Goto Ready3
		
	Flash:
		TNT1 A 4
        Goto LightDone
	Spawn:
		VLAS A 0 NoDelay
		PLAS A 10 {
			if ( GetCvar( "V5_MODELS" ) == 1 ){
				If ( GetCVar( "V5_Cull" ) == 0 ) {
					A_SetSpawnSprite("VLAS");
					If ( GetCvar( "V5_Quake3" ) == 1 ){
						A_settics(1); bFLOATBOB = true; A_setangle(normalize180(angle) + V5_Q3Spin,SPF_INTERPOLATE); SetZ(floorz+16.0);
					}
					else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
				}
				else {
					if( !A_CHECKRANGE( V5_MDist , "NULL", TRUE) ) {
						A_SetSpawnSprite("VLAS");
						If ( GetCvar( "V5_Quake3" ) == 1 ){
							A_settics(1); bFLOATBOB = true; A_setangle(normalize180(angle) + V5_Q3Spin,SPF_INTERPOLATE); SetZ(floorz+16.0);
						}
						else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
					}
					else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
				}
			}
			else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
		}
		"####" A 0 {
				If ( GetCVar( "V5_MODELS" ) == 1 && GetCvar( "V5_Quake3" ) == 1 ){
				If ( GetCVar( "V5_Cull" ) == 0 ) {SetZ(floorz+16.0);}
					else{ 
						if( A_CHECKRANGE( V5_MDist , "NULL", TRUE) ) {bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
					}
				}
				else{bFLOATBOB=false;A_setangle(90,SPF_INTERPOLATE);}
		}
		LOOP
	DeCharge:
		TNT1 A 0 {
			A_StopSound(7);
			A_PlaySoundEx("PLSDEARG","Weapon");
			A_ZoomFactor(1.0);
			}
		PLSA A 1 BRIGHT A_FireCustomMissile("BlueFlareSpawn",0,0,0,0)
		PLSA B 1 BRIGHT A_FireCustomMissile("BlueFlareSpawn",0,0,0,0)
		PLSA C 1 BRIGHT A_FireCustomMissile("BlueFlareSpawn",0,0,0,0)
		PLSA D 1 BRIGHT A_FireCustomMissile("BlueFlareSpawn",0,0,0,0)
		PLSA C 1 BRIGHT A_FireCustomMissile("BlueFlareSpawn",0,0,0,0)
		PLHE I 2 BRIGHT
		PLHE H 1 BRIGHT
		PLHE G 2 BRIGHT
		PLHE F 1 BRIGHT
		PLHE E 2 BRIGHT
		PLHE D 1 BRIGHT
		PLHE C 2 BRIGHT
		PLHE B 1 BRIGHT
		PLHE A 2 BRIGHT
		TNT1 A 0 A_PlaySound("BEPBEP", 5, 1.2)
		TNT1 A 0 A_ClearReFire
		Goto Ready3

    Reload:
		TNT1 A 0 A_ClearReFire
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "ReloadDualWield")
		TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",50,"Ready3")
        TNT1 A 0 A_JumpIfInventory("Cell",1,1)
        Goto Ready3
		TNT1 A 0 {
			A_SetCrosshair(5);
			A_GiveInventory("RespectPlasmaGun");
			A_Giveinventory("PB_LockScreenTilt",1);
			A_PlaySoundEx("PLSM2RL", "Auto");
			A_ClearOverlays(10,11);
		}
		P1R0 ABCDE 1 A_SetRoll(roll-0.2)
		P1R0 FGHIJ 1 A_SetRoll(roll+0.2)
		P1R0 J 1 Offset(1,32)
		P1R0 J 1 Offset(2,34)
		P1R0 J 1 Offset(3, 36)
		P1R0 J 1 Offset(3, 38)
		P1R0 J 5 Offset(4, 40)
		TNT1 A 0 A_JumpIfInventory("PlasmaRifleHasUnloaded",1,"ReloadUnload")
		P1R0 M 1 Offset(4, 38)
		P1R0 M 1 Offset(3, 36)
		P1R0 R 1 Offset(1, 34)
		P1R0 R 1 Offset(0, 32)
		P1R0 RQ 1 A_SetRoll(roll-0.4)
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellout","Auto")
		P1R0 PO 1 A_SetRoll(roll-0.4)
		P1R0 NMLK 1 A_SetRoll(roll-0.4)
		TNT1 A 0 PB_SpawnCasing("EmptyCell",29,random(10,12),20,0,random(-4,-2),2)
		P1R0 K 10
		P1R0 LLLL 1 A_SetRoll(roll+0.4)
	FinishingReload:
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellin","Auto")
		P1R0 MNOP 1 A_SetRoll(roll+0.4)
		
		P1R0 QRSSSSTUV 1
		P1R0 WXYZ 1 A_SetRoll(roll-0.2)
		P1R1 ABCD 1 A_SetRoll(roll+0.2)
		Goto InsertBullets
	ReloadUnload:
		P1R0 KK 1 Offset(4, 38){
			A_SetRoll(roll-0.2);
			}
		P1R0 KK 1 Offset(3, 36){
			A_SetRoll(roll-0.2);
			}
		P1R0 LL 1 Offset(1, 34) {
			A_SetRoll(roll-0.2);
			}
		P1R0 LL 1 Offset(0, 32) {
			A_SetRoll(roll-0.2);
			}
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma",1,"ReloadDualUnloadContinue")
		Goto FinishingReload
		
	ReloadDualWield:
		TNT1 A 0 {
			if (CountInv("PlasmaAmmo") >= 50 && CountInv("LeftPlasmaAmmo") >= 50) {
				return state("ReadyDualWield");
			}
			return state("");
		}
        TNT1 A 0 A_JumpIfInventory("Cell",1,1)
        Goto ReadyDualWield
		TNT1 A 0 {
			A_SetCrosshair(5);
			A_GiveInventory("RespectPlasmaGun");
			A_Giveinventory("PB_LockScreenTilt",1);
			A_PlaySoundEx("PLSM2RL", "Auto");
			A_ClearOverlays(10,11);
		}
		//P2R0 HGE 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		//P2R0 DCBA 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		
		TNT1 A 0 A_JumpIf(CountInv("PlasmaAmmo") >= 50,"ReloadLeftOnly")
		//Reload Right
		P2R1 ABC 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		P2R1 DEF 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P1R0 J 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P1R0 J 1
		P1R0 J 1 Offset(1,32)
		P1R0 J 1 Offset(2,34)
		P1R0 J 1 Offset(3, 36)
		P1R0 J 1 Offset(3, 38)
		P1R0 J 5 Offset(4, 40)
		TNT1 A 0 A_JumpIfInventory("PlasmaRifleHasUnloaded",1,"ReloadUnload")
		P1R0 M 1 Offset(4, 38)
		P1R0 M 1 Offset(3, 36)
		P1R0 R 1 Offset(1, 34)
		P1R0 R 1 Offset(0, 32)
		P1R0 RQ 1 A_SetRoll(roll-0.4)
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellout","Auto")
		P1R0 PO 1 A_SetRoll(roll-0.4)
		P1R0 NMLK 1 A_SetRoll(roll-0.4)
		TNT1 A 0 PB_SpawnCasing("EmptyCell",29,random(10,12),20,0,random(-4,-2),2)
		P1R0 K 10
		P1R0 LLLL 1 A_SetRoll(roll+0.4)
	ReloadDualUnloadContinue:
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellin","Auto")
		P1R0 MNOP 1 A_SetRoll(roll+0.4)
		
		P1R0 QRSSSS 1
		TNT1 A 0 A_JumpIfInventory("LeftPlasmaAmmo",50,"InsertBullets_RightOnly")
		P1R0 TUVWXYZ 1 //A_SetRoll(roll-0.2)
		PLSS DCBA 1
		Goto ReloadLeft
		
	ReloadLeftOnly:
		P2R1 A 1 A_Setroll(roll-0.4, SPF_INTERPOLATE)
		P2R2 AB 1 A_Setroll(roll-0.4, SPF_INTERPOLATE)
		P2R2 CDE 1 A_Setroll(roll+0.3, SPF_INTERPOLATE)
		P1R3 D 1 A_Setroll(roll+0.3, SPF_INTERPOLATE)
		P1R3 E 1
		Goto ReloadLeftContinue
		
	ReloadRightOnlyDone:
		TNT1 A 0 A_WeaponOffset(0,32)
		P2R1 GHIJK 1 A_Setroll(roll-0.4, SPF_INTERPOLATE)
		P2R1 LMNO 1 A_Setroll(roll+0.3, SPF_INTERPOLATE)
		Goto Ready3
	
	ReloadLeft:
		P1R3 WXYZ 1
		P1R3 ABCDE 1
	ReloadLeftContinue:	
		P1R3 E 1 Offset(-1,32)
		P1R3 E 1 Offset(-2,34)
		P1R3 E 1 Offset(-3, 36)
		P1R3 E 1 Offset(-3, 38)
		P1R3 E 5 Offset(-4, 40)
	TNT1 A 0 A_JumpIfInventory("PlasmaRifleHasUnloaded",1,"ReloadFromUnloadedLeft")
		P1R3 H 1 Offset(-4, 38)
		P1R3 H 1 Offset(-3, 36)
		P1R3 M 1 Offset(-1, 34)
		P1R3 M 1 Offset(0, 32)
		P1R3 ML 1 A_SetRoll(roll-0.4)
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellout","Auto")
		P1R3 KJ 1 A_SetRoll(roll-0.4)
		P1R3 IHGF 1 A_SetRoll(roll-0.4)
		TNT1 A 0 PB_SpawnCasing("EmptyCell",29,random(-12,-10),20,0,random(2,4),2)
		P1R3 F 10
		P1R3 GGGG 1 A_SetRoll(roll+0.4)
	ReloadDualUnloadLeftContinue:
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellin","Auto")
		P1R3 HIJK 1 A_SetRoll(roll+0.4)
		P1R3 LMNNNN 1
	Goto InsertBullets4
	
	ReloadFromUnloadedLeft:
		P1R3 FF 1 Offset(-4, 38){
			A_SetRoll(roll+0.2);
			}
		P1R3 FF 1 Offset(-3, 36){
			A_SetRoll(roll+0.2);
			}
		P1R3 GG 1 Offset(-1, 34) {
			A_SetRoll(roll+0.2);
			}
		P1R3 GG 1 Offset(-0, 32) {
			A_SetRoll(roll+0.2);
			}
		Goto ReloadDualUnloadLeftContinue
	
	FinishDualReload:
		TNT1 A 0 A_WeaponOffset(0,32)
		P2R2 FGHIJ 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		P2R2 KLM 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P2R1 O 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		Goto Ready3
		
	InsertBullets:
		TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",50,"Ready3")
		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
		Goto Ready3
		TNT1 A 0 {
			A_Giveinventory("PlasmaAmmo",1);
			A_Takeinventory("Cell",1);
			A_TakeInventory("PlasmaRifleHasUnloaded", 1);
		}
		Goto InsertBullets
	
	InsertBullets4:
		TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",50,"InsertBullets5")
		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
		Goto InsertBullets5
		TNT1 A 0 {
			A_Giveinventory("PlasmaAmmo",1);
			A_Takeinventory("Cell",1);
			A_TakeInventory("PlasmaRifleHasUnloaded", 1);
		}
		Goto InsertBullets4
		
	InsertBullets_RightOnly:
		TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",50,"ReloadRightOnlyDone")
		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
		Goto ReloadRightOnlyDone
		TNT1 A 0 {
			A_Giveinventory("PlasmaAmmo",1);
			A_Takeinventory("Cell",1);
			A_TakeInventory("PlasmaRifleHasUnloaded", 1);
		}
		Goto InsertBullets_RightOnly
		
	InsertBullets5:
		TNT1 A 0 A_JumpIfInventory("LeftPlasmaAmmo",50,"FinishDualReload")
		TNT1 A 0 A_JumpIfInventory("Cell",1,1)
		Goto Ready3
		TNT1 A 0 {
			A_Giveinventory("LeftPlasmaAmmo",1);
			A_Takeinventory("Cell",1);
		}
		Goto InsertBullets5
		

	AlreadyUnloaded:
		TNT1 A 0 A_Takeinventory("Unloading",1)
		Goto Ready3
	UnloadDualWield:
		PLSR A 0 A_WeaponReady
		TNT1 A 0 A_JumpIfInventory("PlasmaRifleHasUnloaded", 1, "AlreadyUnloaded")
		TNT1 A 0 {
			A_ClearOverlays(10,11);
			A_StopSound(6);
			A_ZoomFactor(1.0);
			A_Takeinventory("Unloading",1);
			A_Takeinventory("ADSmode",1);
			A_Takeinventory("Zoomed",1);
		}
		TNT1 A 0 {
			if (CountInv("PlasmaAmmo") <= 0 && CountInv("LeftPlasmaAmmo") <= 0) {
				return state("ReadyDualWield");
			}
			else if(CountInv("PlasmaAmmo") <= 0 && CountInv("LeftPlasmaAmmo") != 0) { 
				return state("UnloadLeftOnly");
				}
			return state("");
		}
		P2R1 ABC 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		P2R1 DEF 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P1R0 J 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P1R0 J 1
		P1R0 J 1 Offset(1,32)
		P1R0 J 1 Offset(2,34)
		P1R0 J 1 Offset(3, 36)
		P1R0 J 1 Offset(3, 38)
		P1R0 J 5 Offset(4, 40)
		P1R0 M 1 Offset(4, 38)
		P1R0 M 1 Offset(3, 36)
		P1R0 R 1 Offset(1, 34)
		P1R0 R 1 Offset(0, 32)
		P1R0 RQ 1 
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellout","Auto")
		P1R0 PO 1 
		P1R0 NMLK 1 
		P1R0 K 3
		TNT1 A 0 A_JumpIf(CountInv("LeftPlasmaAmmo") < 1, "RemoveBullets_Right")
		P1R0 JIHGFF 1
		PLSS DCBA 1
		Goto RemoveBullets_Right
	UnloadLeftOnly:
		P2R1 A 1 A_Setroll(roll-0.4, SPF_INTERPOLATE)
		P2R2 AB 1 A_Setroll(roll-0.4, SPF_INTERPOLATE)
		P2R2 CDE 1 A_Setroll(roll+0.3, SPF_INTERPOLATE)
		P1R3 D 1 A_Setroll(roll+0.3, SPF_INTERPOLATE)
		P1R3 E 1
		Goto UnloadLeftContinue
		
	UnloadLeft:
		TNT1 A 0 A_JumpIfInventory("LeftPlasmaAmmo",1,1)
		Goto UnloadFinishedRightOnly
		P1R3 WXYZU 1 A_SetRoll(roll+0.2)
		P1R3 ABCDE 1 A_SetRoll(roll-0.2)
	UnloadLeftContinue:
		P1R3 E 1 Offset(-1,32)
		P1R3 E 1 Offset(-2,34)
		P1R3 E 1 Offset(-3, 36)
		P1R3 E 1 Offset(-3, 38)
		P1R3 E 5 Offset(-4, 40)
		P1R3 H 1 Offset(-4, 38)
		P1R3 H 1 Offset(-3, 36)
		P1R3 M 1 Offset(-1, 34)
		P1R3 M 1 Offset(-0, 32)
		P1R3 LK 1 
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellout","Auto")
		P1R3 JI 1 
		P1R3 HGFE 1
		P1R3 E 3
		Goto RemoveBullets_Left
	Unload:
		PLSR A 0 A_WeaponReady
		TNT1 A 0 A_JumpIfInventory("PlasmaRifleHasUnloaded", 1, "AlreadyUnloaded")
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma",1,"UnloadDualWield")
		TNT1 A 0 {
			A_ClearOverlays(10,11);
			A_StopSound(6);
			A_ZoomFactor(1.0);
			A_Takeinventory("Unloading",1);
			A_Takeinventory("ADSmode",1);
			A_Takeinventory("Zoomed",1);
		}
        TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",1,1)
        Goto GunEmpty
		P1R0 ABCDE 1 A_SetRoll(roll-0.2)
		P1R0 FGHIJ 1 A_SetRoll(roll+0.2)
		P1R0 J 1 Offset(1,32)
		P1R0 J 1 Offset(2,34)
		P1R0 J 1 Offset(3, 36)
		P1R0 J 1 Offset(3, 38)
		P1R0 J 5 Offset(4, 40)
		P1R0 M 1 Offset(4, 38)
		P1R0 M 1 Offset(3, 36)
		P1R0 R 1 Offset(1, 34)
		P1R0 R 1 Offset(0, 32)
		P1R0 RQ 1 
		TNT1 A 0 A_PlaySoundEx("weapons/plasma/cellout","Auto")
		P1R0 PO 1 
		P1R0 NMLK 1 
		P1R0 K 3
		P1R0 JIHGFEDCBA 1
	RemoveBullets:
		TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",1,1)
		Goto FinishUnload
		TNT1 A 0 {
			A_Takeinventory("PlasmaAmmo",1);
			A_Giveinventory("Cell",1);
			}
		Goto RemoveBullets
	RemoveBullets_Right:
		TNT1 A 0 A_JumpIfInventory("PlasmaAmmo",1,1)
		Goto UnloadLeft
		TNT1 A 0 {
			A_Takeinventory("PlasmaAmmo",1);
			A_Giveinventory("Cell",1);
			}
		Goto RemoveBullets_Right
	RemoveBullets_Left:
		TNT1 A 0 A_JumpIfInventory("LeftPlasmaAmmo",1,1)
		Goto FInishUnloadDualWield
		TNT1 A 0 {
			A_Takeinventory("LeftPlasmaAmmo",1);
			A_Giveinventory("Cell",1);
			}
		Goto RemoveBullets_Left
	
	FInishUnload:
		TNT1 A 0 A_GiveInventory("PlasmaRifleHasUnloaded", 1)
		TNT1 A 0 A_Takeinventory("Unloading",1)
		Goto GunEmpty
	FInishUnloadDualWield:
		TNT1 A 0 A_GiveInventory("PlasmaRifleHasUnloaded", 1)
		TNT1 A 0 A_Takeinventory("Unloading",1)
		P1R3 D 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P2R2 EDC 1 A_Setroll(roll-0.3, SPF_INTERPOLATE)
		P2R2 BA 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		P2R1 A 1 A_Setroll(roll+0.4, SPF_INTERPOLATE)
		Goto ReadyDualWield
	UnloadFinishedRightOnly:
		TNT1 A 0 A_GiveInventory("PlasmaRifleHasUnloaded", 1)
		TNT1 A 0 A_Takeinventory("Unloading",1)
		P1R0 J 1 A_Setroll(roll+0.3, SPF_INTERPOLATE)
		P2R1 FED 1 A_Setroll(roll+0.3, SPF_INTERPOLATE)
		P2R1 CBA 1 A_Setroll(roll-0.4, SPF_INTERPOLATE)
		Goto ReadyDualWield
//////////////////////////////////////////Unloading

	FlashKicking:
		TNT1 A 0 A_ClearOverlays(10,11)
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "FlashKickingDualWield")
		PLSG WXYZ 1
		P1R2 CDEEDC 1
		PLSG ZYXW 1
		PLSG AA 1 
		Stop
	FlashAirKicking:
		TNT1 A 0 A_ClearOverlays(10,11)
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "FlashAirKickingDualWield")
		PLSG WXYZ 1
		P1R2 BCDEEDCB 1
		PLSG ZYXW 1
		PLSG AA 1 
		Stop
	FlashSlideKicking:
		TNT1 A 0 A_ClearOverlays(10,11)
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "FlashSlideKickingDualWield")
		PLSG WXYZ 1
		P1R2 ABCDEFGHHHIJKLMNEDCB 1  
		PLSG ZYXW 1  
		Stop
	FlashSlideKickingStop:
		TNT1 A 0 A_ClearOverlays(10,11)
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "FlashSlideKickingStopDualWield")
		P1R2 DCB 1
		PLSG ZYXW 1  
		Stop
	FlashPunching:
		TNT1 A 0 A_ClearOverlays(10,11)
		TNT1 A 0 A_JumpIfInventory("DualWieldingPlasma", 1, "FlashPunchingDualWield")
		PLSG WXYZ 1
		P1R2 CDEEDC 1
		PLSG ZYXW 1
		PLSG AA 1 
		Stop
	FlashPunchingDualWield:
		TNT1 A 15
		Stop
		
	FlashKickingDualWield:
		P3R0 ABCDEF 1
		P3R0 F 2 A_WeaponOffset(0, 36)
		P3R0 FEDCBA 1 A_WeaponOffset(0,32)
		Stop
		
	FlashAirKickingDualWield:
		P3R0 ABCDEF 1
		P3R0 F 4 A_WeaponOffset(0, 36)
		P3R0 FEDCBA 1 A_WeaponOffset(0,32)
		stop
		
	FlashSlideKickingDualWield:
		P3R0 ABCDEF 1
		P3R0 F 1 A_WeaponOffset(0,34)
		P3R0 GHIIJJ 1
		P3R0 KKLLM 1
		P3R0 FF 1 A_WeaponOffset(0,32)
		P3R0 EDCBA 1 A_WeaponOffset(0,32)
		stop
		
	FlashSlideKickingStopDualWield:
		P3R0 FF 1 A_WeaponOffset(0,32)
		P3R0 EDCBA 1 A_WeaponOffset(0,32)
		stop
	}
}

ACTOR PlasmaGauntlet
{
	Game Doom
	Projectile
	Height 12
	Radius 40
	Speed 6
	Damage (random(1,2))
	DamageType Plasma
	+NOEXTREMEDEATH
	-EXTREMEDEATH
	Obituary "%o became an electrical conductor for %k"
	States
	{
    Spawn:
        TNT1 A 1
        Stop
	}
}

ACTOR Plasma_Ball: FastProjectile Replaces PlasmaBall
{
	Radius 10
	Height 2
	Speed 60
	Damage 8
    DamageType Plasma
	Decal "SmallerScorch"
	Projectile
	Gravity 0
	+RANDOMIZE
	
	//+SHOOTABLE
	-NOBLOCKMAP
	+NOBLOOD
	+NORADIUSDMG
	+THRUSPECIES
	+MTHRUSPECIES
	Species "Marines"
	damagefactor "Blood", 0.0 damagefactor "BlueBlood", 0.0 damagefactor "GreenBlood", 0.0 damagefactor "Taunt", 0.0 damagefactor "KillMe", 0.0 damagefactor "Shrapnel", 0.0
	Health 5
	
renderstyle ADD
Scale 0.19
	DeathSound "weapons/plasmax"
	//SeeSound "PLSM9"
    SeeSound "None"
	Obituary "$OB_MPPLASMARIFLE"
	States
	{
		
		Spawn:
			DB19 ABC 1 BRIGHT Light("PLASMABALLSMALL")
			Loop

		Xdeath:
			TNT1 A 0 A_SpawnItem ("Plasma_Puff", 0)
			TNT1 A 0 A_CustomMissile ("BluePlasmaFire", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 AAAA 0 A_CustomMissile ("RailGunTrailSpark", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 A 1 A_Explode(6,50,0)
			TNT1 A 4
			TNT2 AAA 9 A_CustomMissile ("PlasmaSmoke", 1, 0, random (0, 360), 2, random (0, 160))
			Stop

		Death:
			TNT1 A 0 A_SpawnItem ("Plasma_Puff", 0)
			TNT1 B 1 //A_Explode(6,50,1)
			TNT1 A 0 A_SpawnItemEx ("DetectFloorCraterSmall",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0)
			TNT1 A 0 A_SpawnItemEx ("DetectCeilCraterSmall",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0)
			TNT1 A 0 A_CustomMissile ("BluePlasmaFire", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 AAA 0 A_CustomMissile ("BluePlasmaParticle", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 B 4	
			TNT2 AAAAAA 9 A_CustomMissile ("PlasmaSmoke", 1, 0, random (0, 360), 2, random (0, 160))
			Stop
	}
}

Actor MeatshieldPlasmaBall: Plasma_Ball
{
	+THRUACTORS
	States
	{
		
		Spawn:
			DB19 A 1 BRIGHT
			TNT1 A 0 A_ChangeFlag("THRUACTORS", 0)
		Spawn1:
        DB19 ABC 1 BRIGHT A_SpawnItem("PlasmaFlareSpawner",0,0)
			Loop
	}
}

ACTOR UltPlasma_Ball: Plasma_Ball
{
	Radius 10
	Height 2
	Speed 60
	Damage 8
    DamageType Plasma
	Decal "SmallerScorch"
	Projectile
	+RANDOMIZE
	-NOBLOCKMAP
	+NOBLOOD
	+NORADIUSDMG
	+THRUSPECIES
	+MTHRUSPECIES
	Species "Marines"
	renderstyle ADD
	Scale 0.19
	DeathSound "weapons/plasmax"
    SeeSound "None"
	Obituary "$OB_MPPLASMARIFLE"
	States
	{
	
		Spawn:
			DB19 ABC 1 BRIGHT Light("PLASMABALLSMALL")
			Loop

		Xdeath:
			TNT1 A 0 A_SpawnItem ("Plasma_Puff", 0)
			TNT1 A 0 A_CustomMissile ("BluePlasmaFire", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 AAAAA 0 A_CustomMissile ("BluePlasmaParticle", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 B 1
			TNT1 B 4
			TNT2 AAA 9 A_CustomMissile ("PlasmaSmoke", 1, 0, random (0, 360), 2, random (0, 160))		
			Stop

		Death:
			TNT1 A 0 A_SpawnItem ("Plasma_Puff", 0)
			TNT1 B 1 A_Explode(4,50,0)
			TNT1 A 0 A_SpawnItemEx ("DetectFloorCraterSmall",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0)
			TNT1 A 0 A_SpawnItemEx ("DetectCeilCraterSmall",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0)
			TNT1 A 0 A_CustomMissile ("BluePlasmaFire", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 AAA 0 A_CustomMissile ("BluePlasmaParticle", 0, 0, random (0, 360), 2, random (0, 360))
			TNT1 B 4	
			TNT2 AAAAAA 9 A_CustomMissile ("PlasmaSmoke", 1, 0, random (0, 360), 2, random (0, 160))
			Stop
	}
}

ACTOR PlasmaBall75: Plasma_Ball
{

	SeeSound "PLSM9"
}

ACTOR PlasmaBall76: Plasma_Ball
{
    SeeSound "PLSULT"
	SeeSound "PLSULT"
}
ACTOR PlasmaBall65: Plasma_Ball
{

	SeeSound "PLSM4"
}


Actor EnemyPlasmaBall : PlasmaBall75
{
	Damage (random(10,15))
	DamageType Plasma
	Speed 40
	Species "NotMarines"
	-THRUACTORS
	-THRUSPECIES
	-MTHRUSPECIES
	+THRUGHOST
	//+DONTHURTSPECIES
	States 

	{
		Spawn:
			DB19 ABC 2 BRIGHT Light("PLASMABALLSMALL")
			Loop
		
	}
}


ACTOR ZombiePlasma: EnemyPlasmaBall
{
Damage (random(5,7))
Speed 40
	Scale 0.18
	Radius 8
	Height 2
}
